## 设计带颜色的进度条

####1. 详细描述

说明：在Linux环境下，用C语言设计一个进度条，不同程度的进度会显示不同的颜色。

#### 2. 代码

代码如下：

~~~c
#include <stdio.h>
#include <unistd.h>

int main()
{
	char buff[1000] = { 0 };
	char lable[5] = "-\\|/";
	int i;
	for (; i <= 100; i++)
	{
		buff[i] = '#';

		// \033[;31m %s \033[0m  颜色控制  背景默认 字体颜色分别为为红黄蓝
        
		if (i <= 30) // i<=30 进度条为 红色
		{
			printf("[%d%%][\033[40;37m %c \033[0m][\033[;31m %s \033[0m]\r", i
                   , lable[i % 4], buff);
		}
		else if (i <= 80) // i>30 && i<=80 进度条为 蓝色
		{
			printf("[%d%%][\033[40;37m %c \033[0m][\033[;34m %s \033[0m]\r", i
                   , lable[i % 4], buff);
		}
		else // i>80 && i<=100 进度条为绿色
		{
			printf("[%d%%][\033[40;37m %c \033[0m][\033[;32m %s \033[0m]\r", i
                   ,lable[i % 4], buff);			 
		}
        
		fflush(stdout); // 刷新缓冲区
		usleep(500 * 1000); //显示控制
 	}
	printf("\n");
	return 0;
}
~~~



#### 3. 代码解释

我们将此问题划分为两个模块。模块一：设计进度条；模块二：使进度条附带颜色。

* **如何设计进度条？**

首先，我们定义一个数组`buff[]`。我们在该数组里填充`‘#’`，`‘#’`的个数来表示进度。比如说，当数组只有1个`‘#’`时，进度为`%1`；当数组中有`20`个`‘#’`，进度为`20%`；当数组有`100`个`‘#’`，进度为`100%`。数组内容是从1到100持续变化的，所以肯定需要for循环。

这里需要注意的是我们需要使用的是`\r`而不是`\n`。

` \r `是`return`的简写，表示光标重新回到本行开头。其缩写`CR`是`carriage return`就是回车的意思。

` \n` 是`new line`的简写，表示光标垂直向下移动一行。其缩写`LF`是`Line Feed`就是换行的意思。

这里不过多的解释，自己可以试试`\n`的效果。

~~~c
for（i = 0; i <=100; i++）
{
    printf("[%s]\r",buff);
}
~~~

当然除了简单的进度条，为了使我们可以一眼知道下载进度，我们需要进度占比。我们这里的比较简单，直接随i变化就好，但是当你的数组内容超过100或者不足100的情况下，需要取当前内容占总内容的百分比来表示。

~~~C
for（i = 0; i <=100; i++）
{
	buff[i] = '#';
    printf("[%d%%][%s]\r",i,buff);
}
~~~

我们下载的时候会看到一个转动的圈圈，我们在这里定义一个`lable[]`数组，里面存放`"-\\|/"`，随着每一次循环，通过取模输出一个字符，这样就构成了会动的圈圈。

~~~C
for（i = 0; i <=100; i++）
{
	buff[i] = '#';
    printf("[%d%%][%c][%s]\r", i, lable[i % 4], buff);
}
~~~

最后，我们还需要`fflush()`函数，来刷新缓冲区，是每一次打印结果直接输出。并使用`usleep()`函数来控制显示的间隔时间。注意`usleep()`属于Linux平台下的函数，需要包含头文件`#include <unistd.h>`。

~~~c
for（i = 0; i <=100; i++）
{
	buff[i] = '#';
    printf("[%d%%][%c][%s]\r", i, lable[i % 4], buff);
    fflush(stdout); //刷新缓冲区
	usleep(500 * 1000); //usleep()单位为：微秒 
}
~~~

* **如何控制进度条颜色？**

我们使用ANSI转义序列输出颜色。通用的控制文本颜色的转义序列格式如下：

`CSI n1 [;n2 [;…]] m`

其中`CSI`全称为“控制序列引导器”（Control Sequence Introducer/Initiator），也就是上述示例中的`"\033["`（其中`\033`是你键盘左上角`Esc`键对应的`ASCII`码（八进制））；`n1`、`n2`等表示`SGR`参数，用于控制颜色、粗体、斜体、闪烁等文本输出格式；`m`表示转义序列结束。

通过转义序列设置终端显示属性时，常见格式为：` \033[显示方式;前景色;背景色m输出字符串\033[0m`。

这里分享两篇博文，以供参考。

[Linux终端和win32控制台文本颜色输出](https://www.cnblogs.com/crabxx/p/4046498.html)；[Linux环境下C语言控制字体颜色输出](https://blog.csdn.net/archelogos/article/details/80909869)。

在这里我设计里三种颜色，分别是红、蓝、绿，来表示不同的进度。除此之外，将动画效果设计为黑底白字。

~~~c
if (i <= 30) // i<=30 进度条为 红色
		{
			printf("[%d%%][\033[40;37m %c \033[0m][\033[;31m %s \033[0m]\r", i
                   , lable[i % 4], buff);
		}
		else if (i <= 80) // i>30 && i<=80 进度条为 蓝色
		{
			printf("[%d%%][\033[40;37m %c \033[0m][\033[;34m %s \033[0m]\r", i
                   , lable[i % 4], buff);
		}
		else // i>80 && i<=100 进度条为绿色
		{
			printf("[%d%%][\033[40;37m %c \033[0m][\033[;32m %s \033[0m]\r", i
                   ,lable[i % 4], buff);			 
		}
~~~

以上就是代码的所有解释。

如有问题，欢迎纠正。